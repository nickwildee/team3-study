# delete는 왜 위험한가?

## delete 키워드란?

- 객체에서 **명시적으로 속성을 제거**하고 싶을 때 사용

```js
let myObj {
  name : "hyeok",
  age : "31",
  address : "대한민국 어쩌구...",
}

delete myObj.address // 속성 삭제됨

console.log(myObj.address) // undefined
```

## 속성 제거가 위험한 이유?

최신 브라우저 엔진은 성능 향상을 위해 몇가지 작업을 진행하는데 **delete**키워드는 그 작업을 망가트리게 됩니다.

1. **JIT 컴파일을 통한 최적화가 망가진다.**

JS와 같은 인터프리터 언어는 코드 한줄 한줄을 바로 읽고 실행한다.  
하지만 v8같은 최신 엔진은 성능 향상을 위해 자주 등장하는 코드를 일명 **hot code**로 지정해 미리 기계어 수준의 번역을 진행한다.  
이 때 v8엔진은 해당 객체의 내부 청사진을 기억해 두는데(ex. 속성의 갯수, 속성의 순서 등)  
**delete**로 인해 내부 청사진이 깨졌을 때 v8은 기억하던 객체 모양이 아니기 때문에 **hot code**를 적용하지 않고 이는 성능 저하로 이어진다.

2. **hidden class가 더 이상 적용되지 않는다.**

v8 엔진은 **hidden class**를 부여하여 객체의 형태를 기억하는데, 형태가 같은 객체들은 같은 **hidden class**가 부여되어 v8엔진이 객체 내부를 예측하는데 도움을 준다.  
하지만 **delete**를 사용하게 되면 내부 청사진이 깨지게 되고, 새로운 **hidden class** 로 변경하게 된다.

3. **inline cache**가 무효화된다.

위에 내용에 이어서 새로운 히든 클래스로 변경되면, 인라인 캐시가 같이 무효화 된다.  
인라인 캐시란 자주 접근하는 속성의 주소를 저장해두어 빠른 접근을 가능하게 해주는데,  
히든 클래스가 변하게 되면 기존의 인라인 캐시는 객체 내부 구조가 바뀌었기 때문에 무효화 되고 새로운 객체에서 다시 캐싱을 진행해야한다.  
이는 곧 성능 저하로 이어진다.

## 그럼 아예 쓰지 말아야 하나?

가능한 지양하는 것이 좋으나, 일회용 객체(api 요청, 응답 등)에는 사용해도 괜찮다.

## 참조 레퍼런스

[v8 공식 블로그](https://v8.dev/blog/fast-properties)
